{% extends "global/Page.html" %}
{% load otree static %}

{% block title %}
Ihre Einschätzung zu einer vergangenen Entscheidung
{% endblock %}


{% block content %}
<p>
  Wir sind nun an Ihrer Einschätzung zu einer vergangenen Lotterieentscheidung interessiert. Unten sehen Sie eine
  Lotterie, zu
  der Sie bereits Ihre Zahlungsbereitschaft angegeben haben. <b>Was denken Sie ist die tatsächliche Wahrscheinlichkeit,
    dass diese Lotterie eine Auszahlung von
    {{highest_payoff_state}} hat?</b> Bitte nutzen Sie den Schieberegler, um die Wahrscheinlichkeit anzugeben.
</p>
<p>
  <b>Für Ihre Einschätzung können Sie einen zusätzlichen Bonus von <u>{{Constants.belief_bonus}} Taler</u> verdienen.
  </b>
  Geben Sie dazu den Wert an, der tatsächlich Ihrer Einschätzung entspricht. <b>Die Chance den Bonus zu erhalten richtet
    sich daran wie gut Ihre Einschätzung ist.</b>
  Die genaue Auszahlungsregel ist auf Anfrage am Ende des Experiments einsehbar.
</p>

<div class="card border-secondary mb-3 border-3 bg-light">
  <div class="card-header border-secondary mb-3  border-3">
    <h4 class="card-title"> Erinnerung an die vergangene Entscheidung</h4>
  </div>
  <div class="card-body border-secondary">
    {% include "truncated_reporting/lottery_presentation.html" %}
    <div class="row">
      <div class="col">
        <table class="table borderless" style="text-align: center">
          <tr>
            <td class="w-50 align-middle"> <b>Wie viel sind Sie bereit für diese Lotterie zu bezahlen? </b></td>
            <td class="w-50 float-right">

              <label class="col-form-label"></label>
              <div class="controls">
                <span class="d-inline-block" data-toggle="popover" data-trigger="hover"
                  data-content="Sie haben diese Entscheidung bereits getroffen. Wir sind jetzt an Ihrer Einschätzung interessiert, die Sie unten eingeben können.">

                  <div class="input-group input-group-narrow">

                    <input type="number" class="form-control" value="" disabled><span
                      class="input-group-text">Taler</span>
                  </div>
                </span>
              </div>
            </td>
          </tr>
          <tr>
            <td colspan="2">
              <span class="d-inline-block" data-toggle="popover"  data-trigger="hover" data-content="Sie haben diese Entscheidung bereits getroffen. Wir sind jetzt an Ihrer Einschätzung interessiert, die Sie unten eingeben können.">
                <button class="btn btn-secondary"  style="pointer-events: none;"  type="button" disabled>Weiter</button>
              </span>
            </td>
          </tr>
        </table>
      </div>
    </div>

  </div>
</div>



<div class="card border-secondary mb-3 border-3">
  <div class="card-header border-secondary mb-3  border-3 ">
    <h4 class="card-title"> Ihre Einschätzung</h4>
  </div>
  <table class="w3-table w3-white" style="border-spacing: 0; width: 100%" cellpadding="5">
    <br>
    <tr>
      <td colspan="3">
        Was denken Sie ist die tatsächliche Wahrscheinlichkeit, dass diese Lotterie eine Auszahlung von
        {{highest_payoff_state}} hat?
      </td>
    </tr>
    <tr>
      <td width="10%" align="center"> <strong> 0 %</strong></td>
      <td width="80%">
        <div class="form-group required">
          <div class="controls  field-belief">
            <input type="range" name="belief" id="id_belief_slider" class="slider2" style="width: 100%" min="0"
              max="{{max_value_slider}}" value="{{max_value_slider}}" />
          </div>
        </div>
      </td>
      <td width="10%" align="center"> <strong> {{max_value_slider}} %</strong></td>
    </tr>

    <tr>
      <td colspan="3">

        <span id="click_slider">
          <h5 style="color: red">Bitte klicken Sie auf den Schieberegler, um die Wahrscheinlichkeit anzugeben.
            Sie können Ihre Entscheidung im Anschluss noch verändern.</h5>
        </span>
        <span id="slider_clicked" style="display:none;">
          <h5>Ich glaube, dass die Lotterie mit einer Wahrscheinlichkeit von <b style="color: red"> <span
              id="text_belief">XX
              %</span></b> genau {{highest_payoff_state}} Taler auszahlt.
          </h5>
        </span>

      </td>
    </tr>

    <tr>
      <td align="center" colspan="3">

        <button type="submit" class="btn btn-primary" id="confirm" disabled>Weiter</button>

      </td>
    </tr>
  </table>







</div>
<input type="hidden" name="belief_sequence" id="belief_sequence" />

{% if form.belief_sequence.errors %}{{ form.belief_sequence.errors.0 }}{% endif %}
{% if form.belief.errors %}{{ form.belief.errors.0 }}{% endif %}




{% endblock %}



{% block styles %}
<style>
  .border-3 {
    border-width: 2px !important;
  }

  .borderless tr,
  .borderless td,
  .borderless th {
    border: none !important;
  }


  /* The slider itself */
  .slider {
    -webkit-appearance: none;
    /* Override default CSS styles */
    appearance: none;
    width: 25%;
    /* Full-width */
    height: 10px;
    /* Specified height */
    background: #d3d3d3;
    /* Grey background */
    outline: none;
    /* Remove outline */
    -webkit-transition: .2s;
    /* 0.2 seconds transition on hover */
  }





  /* The slider handle (use -webkit- (Chrome, Opera, Safari, Edge) and -moz- (Firefox) to override default look) */
  .slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    /* Override default look */
    appearance: none;
    width: 10px;
    /* Set a specific slider handle width */
    height: 25px;
    /* Slider handle height */
    background: #000000;
  }

  .slider::-moz-range-thumb {
    width: 10px;
    /* Set a specific slider handle width */
    height: 25px;
    /* Slider handle height */
    background: #000000;
  }


  /*An other class to make the thumb of the slider invisible*/
  .slider2 {
    -webkit-appearance: none;
    /* Override default CSS styles */
    appearance: none;
    width: 25%;
    /* Full-width */
    height: 10px;
    /* Specified height */
    background: #d3d3d3;
    /* Grey background */
    outline: none;
    /* Remove outline */
  }





  /* The slider handle (use -webkit- (Chrome, Opera, Safari, Edge) and -moz- (Firefox) to override default look) */
  .slider2::-webkit-slider-thumb {
    -webkit-appearance: none;
    /* Override default look */
    appearance: none;
    width: 25px;
    /* Set a specific slider handle width */
    height: 25px;
    /* Slider handle height */
    background: #000000;
    /* Green background */
    visibility: hidden;
  }

  .slider2::-moz-range-thumb {
    width: 25px;
    /* Set a specific slider handle width */
    height: 25px;
    /* Slider handle height */
    background: #000000;
    /* Green background */
    visibility: hidden;

  }
</style>

{% endblock %}


{% block scripts %}

<script>
$(function () {
  $('[data-toggle="popover"]').popover()
})
</script>


<script>

  var range_input = document.getElementById('id_belief_slider');
  console.log(range_input.value)
  var all_numbers = "";

  range_input.addEventListener('input', function () { updateValues('range') });

  function updateValues(i) {

    // Enable the button to advance after 1.5 seconds
    // Note that this ensures that the person has to click
    // the slider before advancing and hence, the inital value
    // of the slider is never used.
    setTimeout(function () {
      document.getElementById("confirm").disabled = false;
    }, 1500);

    // Show decision text and hidde the placerhold
    document.getElementById("click_slider").style.display = "none";
    document.getElementById("slider_clicked").style.display = "block";



    // Storing all numbers that the participant considered as a belief
    all_numbers = all_numbers + ";" + range_input.value.toString()
    document.getElementById("belief_sequence").value = all_numbers

    // If the participant does not report any value for the moment
    // we hide the thumb of the slider to avoid any anchoring.
    // Note that ranges default to the middle point between min and max (50 here) as a default value
    // As the participant has to click on the slider to activate the button, 
    // this default value will always be overwritten!
    // Also, once the participant clicked on the slider, we will then show him/her only
    // this value that was insert by the intial click!
    document.getElementById("id_belief_slider").className = "slider"
    document.getElementById("text_belief").textContent = range_input.value.toString() + " %"
  }



</script>

{% endblock %}